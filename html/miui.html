<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>
    MIUI下载地址获取
  </title>
  <meta name="theme-color" content="#3f51b5">
  <script src="../js/mdui.min.js" type="text/javascript">
  </script>
  <link href="../css/mdui.min.css" rel="stylesheet" type="text/css">
  <script src="../js/clipboard.min.js">
  </script>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=10.0,user-scalable=1">
  <meta name="theme-color" content="#de698c">
</head>

<body class="mdui-theme-primary-indigo mdui-theme-accent-pink">


  <!--toolbar-->
  <header class="mdui-appbar mdui-appbar-fixed">
    <div class="mdui-toolbar mdui-color-theme">
      <span class="mdui-btn mdui-btn-icon mdui-ripple" onClick="javascript :history.back(-1);"><i
          class="mdui-icon material-icons">&#xe5c4;</i></span>
      <a class="mdui-typo-title">MIUI下载地址</a>
      <div class="mdui-toolbar-spacer"></div>
    </div>
  </header>



  <!--input-->
  <div class="mdui-textfield mdui-textfield-floating-label mdui-container" style="margin-top: 64px">
    <label class="mdui-textfield-label">
      文件名
    </label>
    <input type="text" id="input" oninput="inputing(event)" onchange="inputing(event)" style="float:left; width:100%"
      class="mdui-textfield-input" />
  </div>


  <!--server choose-->
  <div class="mdui-container">
    <div class="mdui-textfield">
      <form id="form1">
        下载服务器：&nbsp;&nbsp;&nbsp;&nbsp;
        <label class="mdui-radio">
          <input type="radio" value="bigota" name="group1" onclick="serverClick()" checked />
          <i class="mdui-radio-icon"></i>
          bigota
        </label>
        &nbsp;&nbsp;
        <label class="mdui-radio">
          <input type="radio" value="hugeota" name="group1" onclick="serverClick()" />
          <i class="mdui-radio-icon"></i>
          hugeota
        </label>
      </form>
    </div>
  </div>


  <!--information-->
  <div class="mdui-container" id="output">
    <div class="mdui-textfield">


      <ul class="mdui-list">
        <li class="mdui-list-item mdui-ripple mdui-col-lg-2 mdui-col-md-3 mdui-col-sm-4">
          <div class="mdui-list-item-content"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe324;</i></div>
          <div class="mdui-list-item-content"><a id="devices"></a></div>
        </li>
        <li class="mdui-list-item mdui-ripple mdui-col-lg-2 mdui-col-md-3 mdui-col-sm-4">
          <div class="mdui-list-item-content"><i class="mdui-list-item-icon mdui-icon material-icons">&#xe1b0;</i></div>
          <div class="mdui-list-item-content"><a id="version"></div>
        </li>
      </ul>
    </div>
  </div>


  <!--button-->
  <div class="mdui-container" id="button">
    <div class="mdui-col mdui-p-a-2 mdui-col-lg-2 mdui-col-md-3 mdui-col-sm-4">
      <button onclick="copy()" class="btn mdui-btn-block mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme">
        复制
      </button>
    </div>
    <div class="mdui-col mdui-p-a-2 mdui-col-lg-2 mdui-col-md-3 mdui-col-sm-4">
      <button onclick="download()" class="mdui-btn-block mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme">
        下载
      </button>
    </div>

  </div>


</body>

<script type="text/javascript">
 
  var url;
  var choose = "bigota";
  var n;

  var input = document.getElementById('input');
  var button = document.getElementById('button');
  output.style.display = "none";
  button.style.display = "none";

  function serverClick(e) {
    var obj = document.getElementsByName("group1");
    for (var i = 0; i < obj.length; i++) {
      if (obj[i].checked) {
        console.log("choose " + obj[i].value);
        choose = obj[i].value;
      }
    }
  }

  function inputing(e) {
    n = [];
    n = input.value.split("_");
    if (n[0] == "miui" && n[4].indexOf("zip") != -1) {
      console.log("获取成功");
      console.log(n);
      document.getElementById("devices").innerText = n[1];
      document.getElementById("version").innerText = n[2];
      output.style.display = "";
      button.style.display = "";
    } else {
      console.log("获取失败");
      output.style.display = "none";
      button.style.display = "none";
    }
  }

  function download() {
    url = "http://" + choose + ".d.miui.com/" + n[2] + "/" + input.value;
    if (n[0] == "miui" && n[4].indexOf("zip") != -1) {
      location.href = url;
    }
  }

  function copy() {
    url = "http://" + choose + ".d.miui.com/" + n[2] + "/" + input.value;
    if (n[0] == "miui" && n[4].indexOf("zip") != -1) {
      new ClipboardJS('.btn', {
        text: function () {
          return url;
        }
      });
      alert("成功复制链接：" + url);

    }
  }

</script>

</html>