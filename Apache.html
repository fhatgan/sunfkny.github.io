<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>一、准备工作</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
    </head>
    <body>
        <h2 id="%e4%b8%80%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c">一、准备工作</h2>
<h3 id="1%e5%b0%86%e8%99%9a%e6%8b%9f%e6%9c%ba%e7%bd%91%e7%bb%9c%e8%ae%be%e7%bd%ae%e4%b8%ba%e6%a1%a5%e6%8e%a5">1.将虚拟机网络设置为桥接</h3>
<h3 id="2%e9%85%8d%e7%bd%ae%e7%bd%91%e5%8d%a1">2.配置网卡</h3>
<pre><code>vim /etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre>
<p>修改如下内容</p>
<pre><code><div>BOOTPROTO=static
IPADDR=192.168.xxx.1
NETMASK=255.255.255.0
</div></code></pre>
<p>重启网络
service network restart</p>
<h2 id="%e4%ba%8c%e5%ae%89%e5%85%a8%e7%ad%96%e7%95%a5">二、安全策略</h2>
<h3 id="1%e6%9b%b4%e6%94%b9selinux%e8%ae%be%e7%bd%ae">1.更改selinux设置</h3>
<pre><code>setenforce 0
</code></pre>
<h3 id="2%e5%85%b3%e9%97%ad%e9%98%b2%e7%81%ab%e5%a2%99">2.关闭防火墙</h3>
<pre><code>service iptables stop
</code></pre>
<p>或者使用<code>setup</code>命令,选择<code>Firewall configuration</code>下的<code>Security Level</code>并设置为<code>Disabled</code>，然后保存退出</p>
<h2 id="%e4%b8%89%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6%e5%8c%85">三、安装软件包</h2>
<h3 id="1%e8%99%9a%e6%8b%9f%e6%9c%ba%e6%8c%82%e8%bd%bd%e5%85%89%e9%a9%b1%e9%95%9c%e5%83%8f%e6%96%87%e4%bb%b6%e9%80%89%e6%8b%a9rhel-66iso">1.虚拟机挂载光驱，镜像文件选择RHEL 6.6.iso</h3>
<h3 id="2%e5%ae%89%e8%a3%85httpdrpm">2.安装httpd.rpm</h3>
<pre><code>rpm -ivh httpd-2.2.15-39.el6.i686.rpm
</code></pre>
<h2 id="%e5%9b%9b%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">四、修改配置文件</h2>
<h3 id="1%e7%bc%96%e8%be%91apache%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">1.编辑Apache主配置文件</h3>
<pre><code>vim /etc/httpd/conf/httpd.conf
</code></pre>
<h3 id="2%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae%e4%bf%ae%e6%94%b9%e6%96%b9%e6%b3%95">2.常用配置修改方法</h3>
<h4 id="1%e7%94%a8%e6%88%b7%e4%b8%aa%e4%ba%ba%e4%b8%bb%e9%a1%b5">（1）用户个人主页</h4>
<pre><code><div>user add long
passwd long
chmod 705 /home/long
mkdir /home/long/public_html
cd /home/long/public_html
echo &quot;This is Long's web&quot; &gt;&gt; index.html
</div></code></pre>
<p>配置文件中</p>
<pre><code><div>&lt;IfModule mod_userdir.c&gt;
	UserDir disabled
	#UserDir public_html
&lt;/IfModule&gt;
</div></code></pre>
<p>修改为</p>
<pre><code><div>&lt;IfModule mod_userdir.c&gt;
	#UserDir disabled
	UserDir public_html
&lt;/IfModule&gt;
</div></code></pre>
<p>浏览格式为</p>
<pre><code><div>http://域名或IP/~username
</div></code></pre>
<h4 id="2%e8%99%9a%e6%8b%9f%e7%9b%ae%e5%bd%95">（2）虚拟目录</h4>
<pre><code><div>mkdir -p /virdir/
cd /virdir/
echo &quot;This is Virtual Directory sample&quot; &gt;&gt; index.html
chmod 705 index.html
</div></code></pre>
<p>配置文件中添加</p>
<pre><code><div>Alias /test &quot;/virdir&quot;
</div></code></pre>
<p>浏览</p>
<pre><code><div>http://域名或IP/test
</div></code></pre>
<p>即可看到虚拟目录中的页面</p>
<h2 id="%e4%ba%94%e9%85%8d%e7%bd%ae%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba">五、配置虚拟主机</h2>
<h3 id="1%e9%85%8d%e7%bd%ae%e5%9f%ba%e4%ba%8eip%e5%9c%b0%e5%9d%80%e7%9a%84%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba">1.配置基于IP地址的虚拟主机</h3>
<h4 id="1%e9%85%8d%e7%bd%ae%e8%99%9a%e6%8b%9f%e7%bd%91%e5%8d%a1">（1）配置虚拟网卡</h4>
<pre><code><div>cd /etc/sysconfig/network-scripts/
cp -p ifcfg-eth0 ifcfg-eth0:1
vim ifcfg-eth0:1
</div></code></pre>
<p>修改如下内容</p>
<pre><code><div>DEVICE=eth0:1
BOOTPROTO=static
IPADDR=192.168.xxx.1
NETMASK=255.255.255.0
</div></code></pre>
<p>重启网络</p>
<pre><code><div>service network restart
</div></code></pre>
<h4 id="2%e5%88%9b%e5%bb%ba%e7%9b%ae%e5%bd%95%e5%92%8c%e9%a1%b5%e9%9d%a2">（2）创建目录和页面</h4>
<p>分别创建/var/www/ip1和/var/www/ip2</p>
<pre><code><div>mkdir /var/www/ip1 /var/www/ip2
cd /var/www/ip1
echo &quot;This is 192.168.xxx.1's web&quot; &gt;&gt; index.html
cd /var/www/ip2
echo &quot;This is 192.168.xxx.2's web&quot; &gt;&gt; index.html
</div></code></pre>
<h4 id="3%e4%bf%ae%e6%94%b9%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">（3）修改主配置文件</h4>
<pre><code><div>vim /etc/httpd/conf/httpd.conf
</div></code></pre>
<p>到达文件末尾（G）
复制文件末尾最后7行（7yy）
粘贴（p）</p>
<pre><code><div>#&lt;VirtualHost *:80&gt;
#    ServerAdmin webmaster@dummy-host.example.com
#    DocumentRoot /www/docs/dummy-host.example.com
#    ServerName dummy-host.example.com
#    ErrorLog logs/dummy-host.example.com-error_log
#    CustomLog logs/dummy-host.example.com-access_log common
#&lt;/VirtualHost&gt;
</div></code></pre>
<p>删去注释并修改</p>
<pre><code><div>&lt;VirtualHost 192.168.xxx.1&gt;
    ...
    DocumentRoot /var/www/ip1
    ...
&lt;/VirtualHost&gt;
&lt;VirtualHost 192.168.xxx.2&gt;
    ...
    DocumentRoot /var/www/ip2
    ...
&lt;/VirtualHost&gt;
</div></code></pre>
<h4 id="4%e6%b5%8f%e8%a7%88">（4）浏览</h4>
<pre><code><div>http://192.168.xxx.1
http://192.168.xxx.2
</div></code></pre>
<h3 id="2%e9%85%8d%e7%bd%ae%e5%9f%ba%e4%ba%8e%e7%ab%af%e5%8f%a3%e5%8f%b7%e7%9a%84%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba">2.配置基于端口号的虚拟主机</h3>
<p>操作同上（2）（3）（4），不过要添加Listen 端口号，在IP后加“:端口“</p>
<pre><code><div>Listen 8080
Listen 8090
...
&lt;VirtualHost 192.168.xxx.1:8080&gt;
    ...
    DocumentRoot /var/www/port8080
    ...
&lt;/VirtualHost&gt;
&lt;VirtualHost 192.168.xxx.1:8090&gt;
    ...
    DocumentRoot /var/www/port8090
    ...
&lt;/VirtualHost&gt;
</div></code></pre>
<h3 id="3%e9%85%8d%e7%bd%ae%e5%9f%ba%e4%ba%8e%e5%9f%9f%e5%90%8d%e7%9a%84%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba">3.配置基于域名的虚拟主机</h3>
<h4 id="1%e5%ae%89%e8%a3%85bind">（1）安装bind</h4>
<pre><code><div>cd /media/RHEL-6.6\ Server.i386/Packages
rpm -ivh bind-9.8.2-0.30.rc1.el6.i686.rpm
</div></code></pre>
<p>修改配置文件</p>
<h4 id="2%e4%bf%ae%e6%94%b9dns%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">（2）修改DNS主配置文件</h4>
<pre><code><div>vim /etc/named.conf
</div></code></pre>
<p>修改如下内容</p>
<pre><code><div>listen on port 53 { any; }
...
allow-query { any; }
</div></code></pre>
<h4 id="3%e4%bf%ae%e6%94%b9namedrfc1912zones%e6%96%87%e4%bb%b6">（3）修改named.rfc1912.zones文件</h4>
<pre><code><div>vim /etc/named.rfc1912.zones
</div></code></pre>
<p>复制最后11行（11yy） 粘贴（p）修改为</p>
<pre><code><div>zone &quot;long.com&quot; IN {
        type master;
        file &quot;long.com.zone&quot;;
        allow-update { none; };
};
</div></code></pre>
<h4 id="4%e5%a2%9e%e5%8a%a0%e5%b9%b6%e4%bf%ae%e6%94%b9%e6%ad%a3%e5%90%91%e8%a7%a3%e6%9e%90%e6%96%87%e4%bb%b6">（4）增加并修改正向解析文件</h4>
<pre><code><div>cd /var/named
cp -p named.localhost long.com.zone
vim long.com.zone
</div></code></pre>
<p>编辑如下</p>
<pre><code><div>$TTL 1D
@	IN SOA	@ root.long.com. (
					0	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	NS	@
	A	127.0.0.1
	AAAA	::1
dns	IN	A	192.168.29.1
aaa	IN	A	192.168.29.1
bbb	IN	A	192.168.29.1
</div></code></pre>
<h4 id="4%e5%88%86%e5%88%ab%e5%88%9b%e5%bb%bavarwwwaaa%e5%92%8cvarwwwbbb">（4）分别创建/var/www/aaa和/var/www/bbb</h4>
<pre><code><div>mkdir /var/www/aaa /var/www/bbb
cd /var/www/aaa
echo &quot;This is aaa web&quot; &gt;&gt; index.html
cd /var/www/bbb
echo &quot;This is bbb web&quot; &gt;&gt; index.html
</div></code></pre>
<h4 id="5%e4%bf%ae%e6%94%b9apache%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">（5）修改Apache主配置文件</h4>
<pre><code><div>NameVirtualhost 192.168.xxx.1
...
&lt;VirtualHost 192.168.xxx.1&gt;
    ...
    ServerName aaa.long.com
    DocumentRoot /var/www/aaa
    ...
&lt;/VirtualHost&gt;
&lt;VirtualHost 192.168.xxx.1&gt;
    ...
    ServerName bbb.long.com
    DocumentRoot /var/www/bbb
    ...
&lt;/VirtualHost&gt;
</div></code></pre>
<h4 id="6%e6%b5%8f%e8%a7%88">（6）浏览</h4>
<pre><code><div>http://aaa.long.com
http://bbb.long.com
</div></code></pre>

    </body>
    </html>